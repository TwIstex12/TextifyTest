<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Textify - –ø—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 50px;
      background: #f2f2f2;
    }
    textarea {
      width: 500px;
      height: 150px;
      padding: 10px;
      font-size: 16px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #result {
      margin-top: 20px;
      width: 500px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .item {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<h1>Textify - –ø—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞</h1>

<textarea id="user-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å..."></textarea>
<button id="analyze-btn">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>

<div id="result"></div>
<script>
const analyzeBtn = document.getElementById("analyze-btn");
const resultDiv = document.getElementById("result");

analyzeBtn.addEventListener("click", () => {
  const text = document.getElementById("user-text").value.trim();
  if (!text) {
    resultDiv.innerHTML = "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞!";
    return;
  }

  resultDiv.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞...";

  fetch("https://api.languagetool.org/v2/check", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: `text=${encodeURIComponent(text)}&language=ru`
  })
  .then(res => res.json())
  .then(data => {
    resultDiv.innerHTML = "";

    if (data.matches && data.matches.length > 0) {
      let correctedText = text; // —Å–æ–∑–¥–∞—ë–º –∫–æ–ø–∏—é —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
      let offsetShift = 0; // –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã —Å–¥–≤–∏–≥–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –ø—Ä–∏ –∑–∞–º–µ–Ω–∞—Ö

      data.matches.forEach(match => {
        const wrongWord = correctedText.substring(match.offset + offsetShift, match.offset + offsetShift + match.length);

        if (match.replacements && match.replacements.length > 0) {
          const replacement = match.replacements[0].value; // –±–µ—Ä—ë–º –ø–µ—Ä–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
          correctedText = 
            correctedText.substring(0, match.offset + offsetShift) +
            replacement +
            correctedText.substring(match.offset + offsetShift + match.length);

          // –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Å–¥–≤–∏–≥
          offsetShift += replacement.length - match.length;
        }
      });

      // –≤—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫
      const errorsBlock = document.createElement("div");
      errorsBlock.innerHTML = "<h3>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:</h3>";
      data.matches.forEach(match => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <strong>–û—à–∏–±–∫–∞:</strong> ${match.message} <br>
          <strong>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:</strong> ${text.substring(match.offset, match.offset + match.length)} <br>
          <strong>–í–∞—Ä–∏–∞–Ω—Ç—ã:</strong> ${match.replacements.map(r => r.value).join(", ")}
        `;
        errorsBlock.appendChild(div);
      });
      resultDiv.appendChild(errorsBlock);

      // –≤—ã–≤–æ–¥–∏–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
      const fixedBlock = document.createElement("div");
      fixedBlock.className = "fixed";
      fixedBlock.innerHTML = `<h3>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</h3><p>${correctedText}</p>`;
      resultDiv.appendChild(fixedBlock);

    } else {
      resultDiv.innerHTML = "–û—à–∏–±–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã üéâ";
    }
  })
  .catch(err => {
    resultDiv.innerHTML = "–û—à–∏–±–∫–∞: " + err;
    console.error(err);
  });
});
</script>

</body>
</html>
